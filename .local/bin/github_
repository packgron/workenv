#!/usr/bin/zsh

set -eu

source $HOME/private/secrets

_usage () {
	cat <<EOF
Usage: github { list | add | del <name> }
	github.com ssh identity helper.

Commands:
	list:	List current keys
	add:	Add current users identity
	del:	Delete specified identity

EOF
}


_list () {
	echo "Using Token: $GITHUB_TOKEN"
	curl -q -H "Authorization: token $GITHUB_TOKEN" https://api.github.com/users/$GITHUB_USER/keys

}

_add () {
	echo "login $(date)" >> $HOME/.we-log
	exit 0
}

_del () {
	echo "logout $(date)" >> $HOME/.we-log
	exit 0
}

case ${1:-h} in
	l*)
		shift
		_list $@
		;;
	a*)
		shift
		_add $@
		;;
	d*)
		shift
		_del $@
		;;
	h*)
		_usage
		;;
	*)
		_usage
		exit 1
		;;
esac
